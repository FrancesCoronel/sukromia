function getSelectedNode(){if(document.selection)return document.selection.createRange().parentElement();var e=window.getSelection(),t;return e.rangeCount>0?(t=e.getRangeAt(0).startContainer.childNodes[0],t&&jQuery(t).is("input")?t:(t=e.getRangeAt(0).startContainer.parentNode,t&&jQuery(t).is("input"),t)):void 0}function replaceSelection(e,t){var n=window.getSelectedNode(),o=jQuery(n);o.textWalk(function(){this.data=this.data.replace(e,t)}),o.val(t)}function decryptSelection(e,t){var n=window.getSelectedNode(),o=jQuery(n);o.textWalk(function(){this.data=this.data.replace(e,t)}),o.val(t)}chrome.extension.onMessage.addListener(function(e,t,n){n("getSelection"==e.method?{data:window.getSelection().toString()}:"replaceSelection"==e.method?{data:window.replaceSelection(e.selectedText,e.processedText)}:"decryptSelection"==e.method?{data:window.decryptSelection(e.selectedText,e.processedText)}:{})}),jQuery.fn.textWalk=function(e){function t(){var n=this.nodeName.toLowerCase();"#text"===n?e.call(this):1===this.nodeType&&this.childNodes&&this.childNodes[0]&&"script"!==n&&"textarea"!==n&&jQuery(this).contents().each(t)}return this.contents().each(t),this};